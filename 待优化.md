### 一、代码优化建议

1. **重复组件抽象**  
```typescript
// 建议将以下重复代码抽象为通用组件：
// - 表格分页逻辑（出现在 cars/costs/revenues 页面）
// - 模态框表单验证（重复出现在 5 个管理页面）
// - 权限树渲染逻辑（permissions/page.tsx 可封装为 <PermissionTree>）

// 示例：创建通用表格组件
components/
  └── common/
      ├── PaginatedTable.tsx  // 封装分页+表格逻辑
      └── FormModal.tsx       // 通用表单模态框
```

2. **状态管理优化**  
```typescript
// 当前问题：多个页面重复获取菜单数据
// 解决方案：在 MenuContext 中增加缓存机制
const refreshMenus = async () => {
  if (menuItems.length === 0) { // 添加缓存检查
    const data = await fetch(...)
    setMenuItems(data)
  }
}
```

3. **API 错误处理统一**  
```typescript
// 创建 errorHandler 中间件
export const errorHandler = (error: Error) => {
  console.error(error);
  return NextResponse.json(
    { error: error.message || '服务器错误' },
    { status: 500 }
  )
}

// 在 API 路由中统一使用
import { errorHandler } from '@/lib/middleware'

export async function GET() {
  try {
    // ...
  } catch (err) {
    return errorHandler(err)
  }
}
```

### 二、冗余依赖清理（package.json）
```json
{
  "dependencies": {
    // 可移除项：
    "@headlessui/react": "^1.7.19",  // 未在代码中使用
    "jsonwebtoken": "^9.0.2",        // 已使用 jose 替代
    "tailwindcss-animate": "^1.0.7"  // 未使用动画特性
    
    // 建议保留：
    "@heroicons/react": "^2.2.0",    // 被多个页面使用
    "date-fns": "^4.1.0",           // 日期处理必需
  }
}
```

### 三、数据库优化
```sql
-- 1. 移除冗余索引
ALTER TABLE `cost_management` 
  DROP INDEX `remark`,  -- 备注字段不需要单独索引
  DROP INDEX `type`;

-- 2. 添加缺失索引
ALTER TABLE `car_info`
  ADD INDEX `register_date` (`register_date`);

-- 3. 合并日志表
-- 当前存在 operation_log 和 revenue_management 中的日志字段
-- 建议统一使用 operation_log 表
```

### 四、文件清理建议
```
可删除文件：
- public/ 下未使用的静态资源
- app/components/ui/Modal.tsx → 已由 FormModal 替代
- data/operation_log.sql       → 功能已整合到其他模块

可合并文件：
- app/api/cars/route.ts 和 app/api/costs/route.ts 
  中存在重复CRUD逻辑，可抽象为通用路由处理器
```

### 五、安全增强
```typescript
// 1. 在 middleware.ts 增加速率限制
import { rateLimit } from '@/lib/rate-limit'

export async function middleware(request: Request) {
  const ip = request.headers.get('x-forwarded-for')
  await rateLimit(ip)
}

// 2. 强化 JWT 配置（lib/auth.ts）
const secret = new TextEncoder().encode(
  process.env.JWT_SECRET || crypto.randomBytes(32).toString('hex')
)
```

### 六、性能优化
```typescript
// 1. 仪表盘数据静态化
export async function generateStaticParams() {
  return [{ page: 'dashboard' }]
}

// 2. 添加 SWR 缓存
import useSWR from 'swr'

function CarsPage() {
  const { data } = useSWR('/api/cars', fetcher, {
    revalidateOnFocus: false
  })
}
```

